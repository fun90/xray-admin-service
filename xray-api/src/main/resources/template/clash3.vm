mixed-port: 7890
allow-lan: false
mode: rule
log-level: info
ipv6: false
external-controller: 0.0.0.0:9090

dns:
  enable: true
  listen: 127.0.0.1:5311
  ipv6: false
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - 223.5.5.5
    - 119.29.29.29
#å½“dnsè§£æå‡ºç°é—®é¢˜æ—¶ï¼Œæ‰“å¼€å¦‚ä¸‹é…ç½®
#  fallback:
#    - è‡ªå·±çš„DNS
#  fallback-filter:
#    geoip: false
#    geoip-code: CN
#    ipcidr:
#      -192.168.0.1/16
#    domain:
#      - éœ€è¦èµ°è‡ªå·±çš„DNSçš„åŸŸåï¼Œå¦‚ï¼š'*.test.com'

proxies:
#foreach($server in $servers)
  #if($server.protocol == "vmess")
  - {name: $server.serverName, server: $server.clientDomain, port: $server.clientPort, type: vmess, uuid: $account.uuid, alterId: $account.maxConnection, cipher: auto, tls: true, skip-cert-verify: false, network: ws, ws-opts: {path: $server.wsPath, headers: {Host: $server.clientDomain}}, udp: false, client-fingerprint: chrome}
  #elseif($server.protocol == "trojan")
  - {name: $server.serverName, server: $server.clientDomain, port: $server.clientPort, type: trojan, password: $account.uuid, sni: $server.clientDomain, skip-cert-verify: false, udp: false, client-fingerprint: chrome}
  #elseif($server.protocol == "vless")
  - {name: $server.serverName, server: $server.clientDomain, port: $server.clientPort, type: vless, uuid: $account.uuid, tls: true, skip-cert-verify: false, network: tcp, udp: false, client-fingerprint: chrome}
  #end
#end

#set($inclueItems = ["vmess", "trojan", "vless"])
#set($supportSevers = [])
#foreach($item in $servers)
  #if($inclueItems.contains($item.protocol))
    #set($result = $supportSevers.add($item))
  #end
#end
#set($delimiter = $lineSeparator)
#set($serverNames = "")
#foreach($item in $servers)
  #if($inclueItems.contains($item.protocol))
    #set($serverNames = "$serverNames      - $item.serverName$delimiter")
  #end
#end
proxy-groups:
  - name: ğŸ”° ä»£ç†
    type: select
    proxies:
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ¯ ç›´è¿
$serverNames

  - name: â™»ï¸ è‡ªåŠ¨é€‰æ‹©
    type: url-test
    url: http://www.gstatic.com/generate_204
    interval: 300
    proxies:
$serverNames

  - name: ğŸ³ OpenAI
    type: select
    proxies:
      - ğŸ”° ä»£ç†
      - ğŸ¯ ç›´è¿
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
$serverNames

  - name: ğŸ’° PayPal
    type: select
    proxies:
      - ğŸ”° ä»£ç†
      - ğŸ¯ ç›´è¿
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
$serverNames

  - name: ğŸ› äºšé©¬é€Š
    type: select
    proxies:
      - ğŸ”° ä»£ç†
      - ğŸ¯ ç›´è¿
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
$serverNames

  - name: ğŸ¶ è°·æ­Œ
    type: select
    proxies:
      - ğŸ”° ä»£ç†
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ¯ ç›´è¿
$serverNames

  - name: ğŸ– YouTube
    type: select
    proxies:
      - ğŸ”° ä»£ç†
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
      - ğŸ¯ ç›´è¿
$serverNames

  - name: ğŸ‘”ï¸ å¾®è½¯
    type: select
    proxies:
      - ğŸ”° ä»£ç†
      - ğŸ¯ ç›´è¿
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
$serverNames

  - name: â˜ï¸ iCloud
    type: select
    proxies:
      - ğŸ¯ ç›´è¿
      - ğŸ”° ä»£ç†
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
$serverNames

  - name: ğŸ è‹¹æœ
    type: select
    proxies:
      - ğŸ¯ ç›´è¿
      - ğŸ”° ä»£ç†
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
$serverNames

  - name: ğŸ¯ ç›´è¿
    type: select
    proxies:
      - DIRECT

  - name: ğŸš« æ‹¦æˆª
    type: select
    proxies:
      - REJECT
      - DIRECT

#set($ruleList = [
  {"name":"Applications", "group":"ğŸ¯ ç›´è¿"},
  {"name":"MyReject", "group":"ğŸš« æ‹¦æˆª"},
  {"name":"MyProxy", "group":"ğŸ”° ä»£ç†"},
  {"name":"MyDirect", "group":"ğŸ¯ ç›´è¿"},
  {"name":"OpenAI", "group":"ğŸ³ OpenAI"},
  {"name":"Amazon", "group":"ğŸ› äºšé©¬é€Š"},
  {"name":"PayPal", "group":"ğŸ’° PayPal"},
  {"name":"Google", "group":"ğŸ¶ è°·æ­Œ"},
  {"name":"YouTube", "group":"ğŸ– YouTube"},
  {"name":"Microsoft", "group":"ğŸ‘”ï¸ å¾®è½¯"},
  {"name":"iCloud", "group":"â˜ï¸ iCloud"},
  {"name":"Apple", "group":"ğŸ è‹¹æœ"},
  {"name":"Private", "group":"ğŸ¯ ç›´è¿"},
  {"name":"Reject", "group":"ğŸš« æ‹¦æˆª"},
  {"name":"TelegramCidr", "group":"ğŸ”° ä»£ç†"}
])
#if ($whitelist == true)
  - name: â›³ï¸ å…¶ä»–
    type: select
    proxies:
      - ğŸ”° ä»£ç†
      - ğŸ¯ ç›´è¿
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
$serverNames
  #set($tmp = $ruleList.add({"name":"Direct", "group":"ğŸ¯ ç›´è¿"}))
#else
  - name: â›³ï¸ å…¶ä»–
    type: select
    proxies:
      - ğŸ¯ ç›´è¿
      - ğŸ”° ä»£ç†
      - â™»ï¸ è‡ªåŠ¨é€‰æ‹©
$serverNames
  #set($tmp = $ruleList.add({"name":"Proxy", "group":"ğŸ”° ä»£ç†"}))
#end

rules:
#foreach( $rule in $ruleList)
  - RULE-SET,$rule.name,$rule.group
#end
  - MATCH,â›³ï¸ å…¶ä»–

rule-providers:
##  AdvertisingLite:
##    type: http
##    behavior: classical
##    url: "$rootUrl/subscribe/rules/clash2/AdvertisingLite.list"
##    path: ./ruleset/AdvertisingLite.yaml
##    interval: 86400
##
##  AdvertisingLiteDomain:
##    type: http
##    behavior: domain
##    url: "$rootUrl/subscribe/rules/clash2/AdvertisingLiteDomain.list"
##    path: ./ruleset/AdvertisingLiteDomain.yaml
##    interval: 86400
##
#foreach( $rule in $ruleList)
  $rule.name:
    type: http
    behavior: classical
    url: "$rootUrl/subscribe/rules/clash2/${rule.name}.list"
    path: ./ruleset/${rule.name}.yaml
    interval: 86400

#end